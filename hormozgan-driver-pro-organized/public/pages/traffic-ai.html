<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Ø³Ø®Ù†Ú¯Ùˆ - Ù‚ÙˆØ§Ù†ÛŒÙ† Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ Ùˆ Ø±Ø§Ù†Ù†Ø¯Ú¯ÛŒ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Vazirmatn', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: white;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            position: relative;
        }
        
        .voice-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }
        
        .voice-btn {
            background: linear-gradient(45deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-family: 'Vazirmatn';
            display: flex;
            align-items: center;
            gap: 8px;
            transition: 0.3s;
        }
        
        .voice-btn.stop {
            background: linear-gradient(45deg, #ef4444, #dc2626);
        }
        
        .voice-btn:hover {
            transform: scale(1.05);
        }
        
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
            padding: 20px;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .message {
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 15px;
            max-width: 80%;
            animation: fadeIn 0.3s ease;
        }
        
        .user-message {
            background: linear-gradient(45deg, #38bdf8, #2563eb);
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }
        
        .ai-message {
            background: rgba(255,255,255,0.1);
            margin-right: auto;
            border-bottom-left-radius: 5px;
        }
        
        .message-time {
            font-size: 0.8em;
            opacity: 0.7;
            margin-top: 5px;
        }
        
        .speaking-indicator {
            display: none;
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid #10b981;
            padding: 10px;
            border-radius: 10px;
            text-align: center;
            margin: 10px 0;
            animation: pulse 2s infinite;
        }
        
        .law-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .law-category {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: 0.3s;
        }
        
        .law-category:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }

        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.1);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 10px;
            cursor: pointer;
            text-decoration: none;
        }
        
        .input-container {
            display: flex;
            gap: 10px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .message-input {
            flex: 1;
            padding: 12px;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 10px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-family: 'Vazirmatn';
        }
        
        .send-btn {
            background: linear-gradient(45deg, #38bdf8, #2563eb);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: 0.3s;
        }
    </style>
</head>
<body>
    <a href="/" class="back-btn">â† Ø¨Ø§Ø²Ú¯Ø´Øª</a>
    
    <div class="header">
        <h1>ğŸš¦ AI Ø³Ø®Ù†Ú¯Ùˆ - Ù‚ÙˆØ§Ù†ÛŒÙ† Ø±Ø§Ù†Ù†Ø¯Ú¯ÛŒ</h1>
        <p>Ø¯Ø³ØªÛŒØ§Ø± ØµÙˆØªÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¨Ø±Ø§ÛŒ Ù‚ÙˆØ§Ù†ÛŒÙ† Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ Ùˆ Ø±Ø§Ù†Ù†Ø¯Ú¯ÛŒ</p>
        
        <div class="voice-controls">
            <button class="voice-btn" onclick="startVoiceRecognition()">
                ğŸ¤ Ø´Ø±ÙˆØ¹ ØµØ­Ø¨Øª
            </button>
            <button class="voice-btn stop" onclick="stopVoiceRecognition()" style="display: none;">
                â¹ï¸ ØªÙˆÙ‚Ù
            </button>
        </div>
    </div>

    <div class="chat-container">
        <!-- Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù‚ÙˆØ§Ù†ÛŒÙ† -->
        <div class="law-categories">
            <div class="law-category" onclick="askAboutLaw('Ø³Ø±Ø¹Øª Ù…Ø¬Ø§Ø²')">
                ğŸš— Ø³Ø±Ø¹Øª Ù…Ø¬Ø§Ø²
            </div>
            <div class="law-category" onclick="askAboutLaw('Ø­Ù‚ ØªÙ‚Ø¯Ù…')">
                ğŸ›‘ Ø­Ù‚ ØªÙ‚Ø¯Ù…
            </div>
            <div class="law-category" onclick="askAboutLaw('Ø¹Ù„Ø§Ø¦Ù… Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ')">
                ğŸ“‹ Ø¹Ù„Ø§Ø¦Ù… Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ
            </div>
            <div class="law-category" onclick="askAboutLaw('Ø¬Ø±Ø§ÛŒÙ… Ø±Ø§Ù†Ù†Ø¯Ú¯ÛŒ')">
                âš–ï¸ Ø¬Ø±Ø§ÛŒÙ… Ø±Ø§Ù†Ù†Ø¯Ú¯ÛŒ
            </div>
            <div class="law-category" onclick="askAboutLaw('ÙˆØ³Ø§ÛŒÙ„ Ù†Ù‚Ù„ÛŒÙ‡')">
                ğŸš› ÙˆØ³Ø§ÛŒÙ„ Ù†Ù‚Ù„ÛŒÙ‡
            </div>
            <div class="law-category" onclick="askAboutLaw('Ù…Ù‚Ø±Ø±Ø§Øª Ù¾Ø§Ø±Ú©ÛŒÙ†Ú¯')">
                ğŸ…¿ï¸ Ù…Ù‚Ø±Ø±Ø§Øª Ù¾Ø§Ø±Ú©ÛŒÙ†Ú¯
            </div>
        </div>

        <!-- Ù†Ø´Ø§Ù†Ú¯Ø± ØµØ­Ø¨Øª Ú©Ø±Ø¯Ù† -->
        <div class="speaking-indicator" id="speakingIndicator">
            ğŸ¤ Ø¯Ø± Ø­Ø§Ù„ Ú¯ÙˆØ´ Ø¯Ø§Ø¯Ù†... ØµØ­Ø¨Øª Ú©Ù†ÛŒØ¯
        </div>

        <div class="chat-messages" id="chatMessages">
            <!-- Ù¾ÛŒØ§Ù… Ø®ÙˆØ´ Ø¢Ù…Ø¯Ú¯ÙˆÛŒÛŒ -->
            <div class="message ai-message">
                <div class="message-text">
                    <strong>ğŸš¦ Ø¨Ù‡ AI Ø³Ø®Ù†Ú¯Ùˆ Ù‚ÙˆØ§Ù†ÛŒÙ† Ø±Ø§Ù†Ù†Ø¯Ú¯ÛŒ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!</strong><br><br>
                    Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯:<br>
                    â€¢ ğŸ¤ Ø¨Ø§ Ø¯Ú©Ù…Ù‡ "Ø´Ø±ÙˆØ¹ ØµØ­Ø¨Øª" Ø¨Ø§ Ù…Ù† ØµØ­Ø¨Øª Ú©Ù†ÛŒØ¯<br>
                    â€¢ ğŸ“ Ø³ÙˆØ§Ù„ Ø®ÙˆØ¯ Ø±Ø§ ØªØ§ÛŒÙ¾ Ú©Ù†ÛŒØ¯<br>
                    â€¢ ğŸš— Ø±ÙˆÛŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯<br><br>
                    Ù…Ù† Ø¯Ø± Ù…ÙˆØ±Ø¯ Ù‚ÙˆØ§Ù†ÛŒÙ† Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ Ùˆ Ø±Ø§Ù†Ù†Ø¯Ú¯ÛŒ Ø¨Ù‡ Ø´Ù…Ø§ Ú©Ù…Ú© Ù…ÛŒâ€ŒÚ©Ù†Ù…!
                </div>
                <div class="message-time">Ù‡Ù… Ø§Ú©Ù†ÙˆÙ†</div>
            </div>
        </div>

        <div class="input-container">
            <input type="text" class="message-input" id="messageInput" 
                   placeholder="Ø³ÙˆØ§Ù„ Ø®ÙˆØ¯ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù‚ÙˆØ§Ù†ÛŒÙ† Ø±Ø§Ù†Ù†Ø¯Ú¯ÛŒ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..." 
                   onkeypress="handleKeyPress(event)">
            <button class="send-btn" onclick="sendMessage()">ğŸ“¤ Ø§Ø±Ø³Ø§Ù„</button>
        </div>
    </div>

    <script>
        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const speakingIndicator = document.getElementById('speakingIndicator');
        const startBtn = document.querySelector('.voice-btn');
        const stopBtn = document.querySelector('.voice-btn.stop');

        let recognition;
        let isListening = false;

        // Ù‚ÙˆØ§Ù†ÛŒÙ† Ø±Ø§Ù†Ù†Ø¯Ú¯ÛŒ
        const trafficLaws = {
            'Ø³Ø±Ø¹Øª Ù…Ø¬Ø§Ø²': `ğŸš— **Ø³Ø±Ø¹Øª Ù…Ø¬Ø§Ø² Ø¯Ø± Ù…Ù†Ø§Ø·Ù‚ Ù…Ø®ØªÙ„Ù:**\n\nâ€¢ Ø¢Ø²Ø§Ø¯Ø±Ø§Ù‡â€ŒÙ‡Ø§: Û±Û±Û°-Û±Û²Û° Ú©ÛŒÙ„ÙˆÙ…ØªØ± Ø¨Ø± Ø³Ø§Ø¹Øª\nâ€¢ Ø¨Ø²Ø±Ú¯Ø±Ø§Ù‡â€ŒÙ‡Ø§: Û¸Û°-Û±Û°Û° Ú©ÛŒÙ„ÙˆÙ…ØªØ± Ø¨Ø± Ø³Ø§Ø¹Øª\nâ€¢ Ù…Ø¹Ø§Ø¨Ø± Ø´Ù‡Ø±ÛŒ: ÛµÛ°-Û¶Û° Ú©ÛŒÙ„ÙˆÙ…ØªØ± Ø¨Ø± Ø³Ø§Ø¹Øª\nâ€¢ Ù…Ù†Ø§Ø·Ù‚ Ù…Ø³Ú©ÙˆÙ†ÛŒ: Û³Û° Ú©ÛŒÙ„ÙˆÙ…ØªØ± Ø¨Ø± Ø³Ø§Ø¹Øª\nâ€¢ Ù†Ø²Ø¯ÛŒÚ©ÛŒ Ù…Ø¯Ø§Ø±Ø³: Û²Û° Ú©ÛŒÙ„ÙˆÙ…ØªØ± Ø¨Ø± Ø³Ø§Ø¹Øª\n\nâš ï¸ **Ø¬Ø±ÛŒÙ…Ù‡ Ø³Ø±Ø¹Øª ØºÛŒØ±Ù…Ø¬Ø§Ø²:**\n- ØªØ§ Û²Û° Ú©ÛŒÙ„ÙˆÙ…ØªØ± Ø¨ÛŒØ´â€ŒØªØ±: ÛµÛ°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†\n- Û²Û° ØªØ§ ÛµÛ° Ú©ÛŒÙ„ÙˆÙ…ØªØ±: Û±Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†\n- Ø¨ÛŒØ´ Ø§Ø² ÛµÛ° Ú©ÛŒÙ„ÙˆÙ…ØªØ±: Û²Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù† + ØªØ¹Ù„ÛŒÙ‚ Ú¯ÙˆØ§Ù‡ÛŒÙ†Ø§Ù…Ù‡`,

            'Ø­Ù‚ ØªÙ‚Ø¯Ù…': `ğŸ›‘ **Ù‚ÙˆØ§Ù†ÛŒÙ† Ø­Ù‚ ØªÙ‚Ø¯Ù…:**\n\nâ€¢ Ø§ÙˆÙ„ÙˆÛŒØª Ø¨Ø§ ÙˆØ³Ø§ÛŒÙ„ Ù†Ù‚Ù„ÛŒÙ‡ Ø§Ù…Ø¯Ø§Ø¯ÛŒ\nâ€¢ Ø®ÙˆØ¯Ø±ÙˆÛŒÛŒ Ú©Ù‡ Ø§Ø² Ø³Ù…Øª Ø±Ø§Ø³Øª Ù…ÛŒâ€ŒØ¢ÛŒØ¯\nâ€¢ Ø¯Ø± Ù…ÛŒØ¯Ø§Ù†â€ŒÙ‡Ø§ØŒ Ø­Ù‚ ØªÙ‚Ø¯Ù… Ø¨Ø§ Ø®ÙˆØ¯Ø±ÙˆÛŒ Ø¯Ø§Ø®Ù„ Ù…ÛŒØ¯Ø§Ù†\nâ€¢ Ø¯Ø± ØªÙ‚Ø§Ø·Ø¹â€ŒÙ‡Ø§ÛŒ Ù‡Ù…â€ŒØ³Ø·Ø­ Ø¨Ø¯ÙˆÙ† Ø¹Ù„Ø§Ù…ØªØŒ Ø­Ù‚ ØªÙ‚Ø¯Ù… Ø¨Ø§ ÙˆØ³ÛŒÙ„Ù‡â€ŒØ§ÛŒ Ø§Ø³Øª Ú©Ù‡ Ø¯Ø± Ø³Ù…Øª Ø±Ø§Ø³Øª Ø´Ù…Ø§Ø³Øª\nâ€¢ Ø¹Ø§Ø¨Ø± Ù¾ÛŒØ§Ø¯Ù‡ Ø¯Ø± Ú¯Ø°Ø±Ú¯Ø§Ù‡ Ø¹Ø§Ø¨Ø± Ù¾ÛŒØ§Ø¯Ù‡ Ø­Ù‚ ØªÙ‚Ø¯Ù… Ù…Ø·Ù„Ù‚ Ø¯Ø§Ø±Ø¯\n\nğŸ¯ **Ù†Ú©ØªÙ‡:** Ù‡Ù…ÛŒØ´Ù‡ Ø§Ø­ØªÛŒØ§Ø· Ú©Ù†ÛŒØ¯ Ø­ØªÛŒ Ø§Ú¯Ø± Ø­Ù‚ ØªÙ‚Ø¯Ù… Ø¨Ø§ Ø´Ù…Ø§Ø³Øª!`,

            'Ø¹Ù„Ø§Ø¦Ù… Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ': `ğŸ“‹ **Ø§Ù†ÙˆØ§Ø¹ Ø¹Ù„Ø§Ø¦Ù… Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ Ùˆ Ø±Ø§Ù†Ù†Ø¯Ú¯ÛŒ:**\n\nğŸ”´ **Ø¹Ù„Ø§Ø¦Ù… Ø¨Ø§Ø²Ø¯Ø§Ø±Ù†Ø¯Ù‡ (Ø¯Ø§ÛŒØ±Ù‡ Ù‚Ø±Ù…Ø²):**\n- ØªÙˆÙ‚Ù Ù…Ù…Ù†ÙˆØ¹\n- ÙˆØ±ÙˆØ¯ Ù…Ù…Ù†ÙˆØ¹\n- Ø³Ø¨Ù‚Øª Ù…Ù…Ù†ÙˆØ¹\n- Ø¯ÙˆØ± Ø²Ø¯Ù† Ù…Ù…Ù†ÙˆØ¹\n\nğŸŸ¡ **Ø¹Ù„Ø§Ø¦Ù… Ù‡Ø´Ø¯Ø§Ø±Ø¯Ù‡Ù†Ø¯Ù‡ (Ù…Ø«Ù„Ø« Ø²Ø±Ø¯):**\n- Ù¾ÛŒÚ† Ø®Ø·Ø±Ù†Ø§Ú©\n- Ø¹Ø¨ÙˆØ± Ø¹Ø§Ø¨Ø± Ù¾ÛŒØ§Ø¯Ù‡\n- Ø±Ø§Ù‡ Ø¨Ø§Ø±ÛŒÚ© Ù…ÛŒâ€ŒØ´ÙˆØ¯\n- Ù¾Ø±ØªØ§Ø¨ Ø³Ù†Ú¯\n\nğŸŸ¢ **Ø¹Ù„Ø§Ø¦Ù… Ø§Ø·Ù„Ø§Ø¹Ø§ØªÛŒ (Ù…Ø³ØªØ·ÛŒÙ„ Ø¢Ø¨ÛŒ):**\n- Ø§ÛŒØ³ØªÚ¯Ø§Ù‡ Ø§ØªÙˆØ¨ÙˆØ³\n- Ø¨ÛŒÙ…Ø§Ø±Ø³ØªØ§Ù†\n- Ù¾Ù…Ù¾ Ø¨Ù†Ø²ÛŒÙ†\n- Ù¾Ø§Ø±Ú©ÛŒÙ†Ú¯`,

            'Ø¬Ø±Ø§ÛŒÙ… Ø±Ø§Ù†Ù†Ø¯Ú¯ÛŒ': `âš–ï¸ **Ø¬Ø±Ø§ÛŒÙ… Ù…Ù‡Ù… Ø±Ø§Ù†Ù†Ø¯Ú¯ÛŒ:**\n\nâ€¢ Ø¹Ø¨ÙˆØ± Ø§Ø² Ú†Ø±Ø§Øº Ù‚Ø±Ù…Ø²: ÛµÛ°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†\nâ€¢ ØµØ­Ø¨Øª Ø¨Ø§ ØªÙ„ÙÙ† Ù‡Ù…Ø±Ø§Ù‡: Û²Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†\nâ€¢ Ø¹Ø¯Ù… Ø¨Ø³ØªÙ† Ú©Ù…Ø±Ø¨Ù†Ø¯ Ø§ÛŒÙ…Ù†ÛŒ: Û±Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†\nâ€¢ Ø±Ø§Ù†Ù†Ø¯Ú¯ÛŒ Ø¨Ø¯ÙˆÙ† Ú¯ÙˆØ§Ù‡ÛŒÙ†Ø§Ù…Ù‡: Û³Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†\nâ€¢ Ø­Ù…Ù„ Ø¨Ø§Ø± Ø§Ø¶Ø§ÙÛŒ: Û±ÛµÛ°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†\nâ€¢ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ø¯Ø®Ø§Ù†ÛŒØ§Øª: ÛµÛ°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†\n\nğŸ’¡ **ØªØ®ÙÛŒÙ Ø¬Ø±ÛŒÙ…Ù‡:**\n- Ù¾Ø±Ø¯Ø§Ø®Øª Ø¯Ø± Û±Û° Ø±ÙˆØ² Ø§ÙˆÙ„: Û³Û°Ùª ØªØ®ÙÛŒÙ\n- Ù¾Ø±Ø¯Ø§Ø®Øª Ø¯Ø± Û²Û° Ø±ÙˆØ² Ø§ÙˆÙ„: Û²Û°Ùª ØªØ®ÙÛŒÙ`,

            'ÙˆØ³Ø§ÛŒÙ„ Ù†Ù‚Ù„ÛŒÙ‡': `ğŸš› **Ù…Ù‚Ø±Ø±Ø§Øª ÙˆØ³Ø§ÛŒÙ„ Ù†Ù‚Ù„ÛŒÙ‡:**\n\nğŸš— **Ø®ÙˆØ¯Ø±ÙˆÙ‡Ø§ÛŒ Ø³ÙˆØ§Ø±ÛŒ:**\n- Ù…Ø¹Ø§ÛŒÙ†Ù‡ ÙÙ†ÛŒ Ø³Ø§Ù„ÛŒØ§Ù†Ù‡ Ø§Ù„Ø²Ø§Ù…ÛŒ\n- Ø¨ÛŒÙ…Ù‡ Ø´Ø®Øµ Ø«Ø§Ù„Ø« Ø§Ù„Ø²Ø§Ù…ÛŒ\n- Ú©Ø§Ø±Øª Ø®ÙˆØ¯Ø±Ùˆ Ù‡Ù…ÛŒØ´Ù‡ Ù‡Ù…Ø±Ø§Ù‡ Ø±Ø§Ù†Ù†Ø¯Ù‡\n\nğŸš **ÙˆÙ† Ùˆ Ù…ÛŒÙ†ÛŒâ€ŒØ¨ÙˆØ³:**\n- Ø­Ø¯Ø§Ú©Ø«Ø± Ø³Ø±Ø¹Øª: Û¸Û° Ú©ÛŒÙ„ÙˆÙ…ØªØ± Ø¨Ø± Ø³Ø§Ø¹Øª\n- Ù…Ù…Ù†ÙˆØ¹ÛŒØª ØªØ±Ø¯Ø¯ Ø¯Ø± Ø¨Ø±Ø®ÛŒ Ø®ÛŒØ§Ø¨Ø§Ù†â€ŒÙ‡Ø§\n- Ú¯ÙˆØ§Ù‡ÛŒÙ†Ø§Ù…Ù‡ Ø±Ø§Ù†Ù†Ø¯Ù‡: Ù¾Ø§ÛŒÙ‡ Û²\n\nğŸšš **Ú©Ø§Ù…ÛŒÙˆÙ† Ùˆ Ú©Ø§Ù…ÛŒÙˆÙ†Øª:**\n- ØªØ±Ø¯Ø¯ Ø¯Ø± Ø´Ù‡Ø±: Û²Û²:Û°Û° ØªØ§ Û¶:Û°Û°\n- Ú¯ÙˆØ§Ù‡ÛŒÙ†Ø§Ù…Ù‡: Ù¾Ø§ÛŒÙ‡ Û± ÛŒØ§ Û²\n- Ù…Ø¹Ø§ÛŒÙ†Ù‡ ÙÙ†ÛŒ Û¶ Ù…Ø§Ù‡Ù‡`,

            'Ù…Ù‚Ø±Ø±Ø§Øª Ù¾Ø§Ø±Ú©ÛŒÙ†Ú¯': `ğŸ…¿ï¸ **Ù‚ÙˆØ§Ù†ÛŒÙ† Ù¾Ø§Ø±Ú©ÛŒÙ†Ú¯ Ùˆ ØªÙˆÙ‚Ù:**\n\nâœ… **Ù…Ù†Ø§Ø·Ù‚ Ù…Ø¬Ø§Ø² Ù¾Ø§Ø±Ú©:**\n- Ù¾Ø§Ø±Ú©ÛŒÙ†Ú¯â€ŒÙ‡Ø§ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ\n- Ú©Ù†Ø§Ø± Ø®ÛŒØ§Ø¨Ø§Ù† Ø¨Ø§ ÙØ§ØµÙ„Ù‡ Û±Ûµ Ù…ØªØ±ÛŒ ØªÙ‚Ø§Ø·Ø¹\n- ÙØ§ØµÙ„Ù‡ Ûµ Ù…ØªØ±ÛŒ Ø§Ø² Ø´ÛŒØ±Ù‡Ø§ÛŒ Ø¢ØªØ´â€ŒÙ†Ø´Ø§Ù†ÛŒ\n\nâŒ **Ù…Ù†Ø§Ø·Ù‚ Ù…Ù…Ù†ÙˆØ¹Ù‡ Ù¾Ø§Ø±Ú©:**\n- Ø±ÙˆÛŒ Ø®Ø· Ø¹Ø§Ø¨Ø± Ù¾ÛŒØ§Ø¯Ù‡\n- Ú©Ù†Ø§Ø± Ú†Ø±Ø§Øº Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ\n- Ø­Ø±ÛŒÙ… ØªÙ‚Ø§Ø·Ø¹â€ŒÙ‡Ø§\n- Ú©Ù†Ø§Ø± Ø§ÛŒØ³ØªÚ¯Ø§Ù‡ Ø§ØªÙˆØ¨ÙˆØ³\n- Ù…Ø³ÛŒØ± ÙˆØ³Ø§ÛŒÙ„ Ù†Ù‚Ù„ÛŒÙ‡ Ø§Ù…Ø¯Ø§Ø¯ÛŒ\n\nğŸ’° **Ø¬Ø±ÛŒÙ…Ù‡ Ù¾Ø§Ø±Ú© ØºÛŒØ±Ù…Ø¬Ø§Ø²:** Û±Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†`
        };

        // Ø¨Ø±Ø±Ø³ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² Speech Recognition
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'fa-IR';

            recognition.onstart = function() {
                isListening = true;
                speakingIndicator.style.display = 'block';
                startBtn.style.display = 'none';
                stopBtn.style.display = 'flex';
            };

            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                messageInput.value = transcript;
                sendMessage();
            };

            recognition.onend = function() {
                isListening = false;
                speakingIndicator.style.display = 'none';
                startBtn.style.display = 'flex';
                stopBtn.style.display = 'none';
            };

            recognition.onerror = function(event) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± ØªØ´Ø®ÛŒØµ ØµØ¯Ø§:', event.error);
                addMessage('âš ï¸ Ø®Ø·Ø§ Ø¯Ø± ØªØ´Ø®ÛŒØµ ØµØ¯Ø§. Ù„Ø·ÙØ§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.', 'ai');
                speakingIndicator.style.display = 'none';
                startBtn.style.display = 'flex';
                stopBtn.style.display = 'none';
            };
        } else {
            startBtn.disabled = true;
            startBtn.innerHTML = 'âŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯';
            startBtn.style.background = '#6b7280';
        }

        function startVoiceRecognition() {
            if (recognition && !isListening) {
                recognition.start();
            }
        }

        function stopVoiceRecognition() {
            if (recognition && isListening) {
                recognition.stop();
            }
        }

        function askAboutLaw(lawType) {
            messageInput.value = lawType;
            sendMessage();
        }

        function sendMessage() {
            const message = messageInput.value.trim();
            if (message) {
                addMessage(message, 'user');
                messageInput.value = '';
                
                setTimeout(() => {
                    const response = getAIResponse(message);
                    addMessage(response, 'ai');
                    speakResponse(response);
                }, 1000);
            }
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            
            const time = new Date().toLocaleTimeString('fa-IR', { 
                hour: '2-digit', minute: '2-digit' 
            });
            
            messageDiv.innerHTML = `
                <div class="message-text">${formatMessage(text)}</div>
                <div class="message-time">${time}</div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function getAIResponse(message) {
            message = message.toLowerCase();
            
            for (const [key, response] of Object.entries(trafficLaws)) {
                if (message.includes(key.toLowerCase())) {
                    return response;
                }
            }
            
            return `ğŸ¤– **Ø¯Ø³ØªÛŒØ§Ø± Ù‚ÙˆØ§Ù†ÛŒÙ† Ø±Ø§Ù†Ù†Ø¯Ú¯ÛŒ:**\n\nØ³ÙˆØ§Ù„ Ø´Ù…Ø§ Ø¯Ø±Ø¨Ø§Ø±Ù‡ "${message}" Ø±Ø§ Ù…ØªÙˆØ¬Ù‡ Ø´Ø¯Ù…!\n\nÙ„Ø·ÙØ§Ù‹ ÛŒÚ©ÛŒ Ø§Ø² Ù…ÙˆØ¶ÙˆØ¹Ø§Øª Ø²ÛŒØ± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:\n\nâ€¢ ğŸš— Ø³Ø±Ø¹Øª Ù…Ø¬Ø§Ø²\nâ€¢ ğŸ›‘ Ø­Ù‚ ØªÙ‚Ø¯Ù…\nâ€¢ ğŸ“‹ Ø¹Ù„Ø§Ø¦Ù… Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ\nâ€¢ âš–ï¸ Ø¬Ø±Ø§ÛŒÙ… Ø±Ø§Ù†Ù†Ø¯Ú¯ÛŒ\nâ€¢ ğŸš› ÙˆØ³Ø§ÛŒÙ„ Ù†Ù‚Ù„ÛŒÙ‡\nâ€¢ ğŸ…¿ï¸ Ù…Ù‚Ø±Ø±Ø§Øª Ù¾Ø§Ø±Ú©ÛŒÙ†Ú¯\n\nÛŒØ§ Ø³ÙˆØ§Ù„ Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ù‚ÛŒÙ‚â€ŒØªØ± Ù…Ø·Ø±Ø­ Ú©Ù†ÛŒØ¯.`;
        }

        function formatMessage(text) {
            return text.replace(/\n/g, '<br>');
        }

        function speakResponse(text) {
            if ('speechSynthesis' in window) {
                // Ø­Ø°Ù Ø¹Ù„Ø§Ø¦Ù… Ùˆ Ø§Ù…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ø®ÙˆØ§Ù†Ø´ Ø¨Ù‡ØªØ±
                const cleanText = text.replace(/[ğŸ¤–ğŸš—ğŸ›‘ğŸ“‹âš–ï¸ğŸš›ğŸ…¿ï¸ğŸ¤âš ï¸âœ…âŒğŸ’¡ğŸ¯ğŸ”´ğŸŸ¡ğŸŸ¢â€¢\-]/g, '');
                
                const speech = new SpeechSynthesisUtterance(cleanText);
                speech.lang = 'fa-IR';
                speech.rate = 0.9;
                speech.pitch = 1;
                
                window.speechSynthesis.speak(speech);
            }
        }

        // Ù¾ÛŒØ§Ù… Ø®ÙˆØ´ Ø¢Ù…Ø¯Ú¯ÙˆÛŒÛŒ ØµÙˆØªÛŒ
        setTimeout(() => {
            const welcomeMsg = "Ø¨Ù‡ Ø§ÛŒ Ø¢ÛŒ Ø³Ø®Ù†Ú¯Ùˆ Ù‚ÙˆØ§Ù†ÛŒÙ† Ø±Ø§Ù†Ù†Ø¯Ú¯ÛŒ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯. Ú†Ú¯ÙˆÙ†Ù‡ Ù…ÛŒ ØªÙˆØ§Ù†Ù… Ú©Ù…Ú© Ú©Ù†Ù…ØŸ";
            if ('speechSynthesis' in window) {
                const speech = new SpeechSynthesisUtterance(welcomeMsg);
                speech.lang = 'fa-IR';
                speech.rate = 0.9;
                window.speechSynthesis.speak(speech);
            }
        }, 2000);
    </script>
</body>
</html>
